<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.w3.org/1999/xhtml">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sign in - MyPharmacie</title>
  <link rel="stylesheet" th:href="@{/css/bootstrap.css}">
  <script th:src="@{/js/bootstrap.min.js}"></script>


  <link rel="shortcut icon" th:href="@{/images/favicon.svg}" type="image/x-icon">
  <link rel="stylesheet" th:href="@{/css/app.css}">
</head>

<body>
<div id="auth">

  <div class="main-content container-fluid" layout:fragment="content">
    <div class="page-title">
      <h3>Ville</h3>
      <p class="text-subtitle text-muted">Liste Ville</p>
    </div>
    <section class="section">
      <!--     ............... Start form Ajouter .................-->
      <form action="#" th:action="@{/api/ville/save}"  method="POST" id="addForm">


        <div id="popupContainer" style="display: none;" class="row">
        <div class="col-sm-6 mb-2">
            <label for="nom">Nom : </label>
            <input class="" type="text" id="id" hidden>
<!--            <input class="form-control" type="text" id="nom" required>-->
            <input class="form-control" type="text" id="nom" th:field="*{ville.nom}" required>

        </div>
      </div>
      </form>
      <!--     ............... END form Ajouter .................-->
      <!--     ............... Start form Ajouter event .................-->
      <div class="row">
        <div class="col">
          <button type="submit" class="btn btn-outline-success mt-3 mb-3" id="btn">Ajouter</button>
        </div>
      </div>


      <!--     ............... END form Ajouter event .................-->

      <!--strat popup ajouter -->


        <script th:inline="javascript">
          $(document).ready(function() {
            // Gérer le clic sur le bouton "Ajouter"
            $('#btn').click(function() {
              $('#popupContainer').modal('show'); // Afficher la fenêtre modale
            });

            // Gérer la soumission du formulaire
            $('#addForm').submit(function(event) {
              event.preventDefault(); // Empêcher la soumission normale du formulaire

              // Récupérer les valeurs saisies dans les champs
              var nom = $('#nom').val();

              // Créer l'objet JSON avec les données du formulaire
              var ville = {
                nom: nom
              };

              // Envoyer une requête AJAX pour enregistrer la ville
              $.ajax({
                url: '/api/ville/save',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(ville),
                success: function(response) {
                  // Traiter la réponse du serveur en cas de succès
                  // Par exemple, recharger la page ou afficher un message de succès
                  alert('La ville a été ajoutée avec succès');
                  window.location.reload();
                },
                error: function(xhr, status, error) {
                  // Traiter les erreurs de la requête AJAX
                  // Par exemple, afficher un message d'erreur
                  alert('Une erreur s\'est produite lors de l\'ajout de la ville');
                }
              });

              // Fermer la fenêtre modale
              $('#popupContainer').modal('hide');
            });
          });
        </script>


<!--      <script th:inline="javascript">-->
<!--        document.getElementById('btn').addEventListener('click', function() {-->
<!--          document.getElementById('popupContainer').style.display = 'block';-->
<!--        });-->

<!--        document.getElementById('addForm').addEventListener('submit', function(event) {-->
<!--          event.preventDefault();-->
<!--          // Add logic to handle form submission and AJAX request to add the data-->
<!--          // You can use JavaScript libraries like Axios or fetch for making AJAX requests-->
<!--          // After successfully adding the data, you can close the popup or perform any other actions as needed-->
<!--          document.getElementById('popupContainer').style.display = 'none';-->
<!--        });-->
<!--      </script>-->

      <!--end popup ajouter -->

      <!--     ............... START List   .................-->
      <div class="row mb-4">
        <div class="col-md-8">
          <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
              <h4 class="card-title">YOUR LIST</h4>
              <div class="d-flex ">
                <i data-feather="download"></i>
              </div>
            </div>
            <div class="card-body px-0 pb-0">
              <div class="table-responsive">
                <table class="table mb-0" id="table1">
                  <thead>
                  <tr>
                    <th>id</th>
                    <th>Nom ville</th>
                    <th>Action</th>
                  </tr>
                  </thead>
                  <tbody>
                  <tr th:each="ville : ${entities}">
                    <td th:text="${ville.id}"></td>
                    <td th:text="${ville.nom}"></td>
                    <td>
                      <form id="deleteForm" th:action="@{/api/ville/delete/{id}(id=${ville.id})}" method="get">
                        <input type="hidden" name="_method" value="DELETE">
                        <button type="button" onclick="deleteVille()">Delete</button>
                      </form>

                      <script th:inline="javascript">
                        function deleteVille() {
                          if (confirm('Are you sure you want to delete this ville?')) {
                            var form = document.getElementById('deleteForm');
                            form.setAttribute('method', 'DELETE');
                            form.submit();
                          }
                        }
                      </script>
                      <a th:href="@{/update/{id}(id=${ville.id})}" class="btn btn-primary">Update</a>
                      <a th:href="@{/api/ville/delete/{id}(id=${ville.id})}" class="btn btn-danger">Delete</a>

                    </td>
                  </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!--     ............... END List   .................-->
    </section>
  </div>
</div>
</body>

<script th:src="@{/js/feather.min.js}"></script>
<script th:src="@{/js/app.js}"></script>

<script th:src="@{/js/main.js}"></script>
</body>

</html>